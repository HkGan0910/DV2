<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NATO: 75 Years of Collective Defense</title>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
<style>
	body { font-family: system-ui,Segoe UI,Roboto,Arial; margin: 18px; color:#13334d; }
	.header { display:flex; gap:12px; align-items:center; margin-bottom:10px; }
	.controls { display:flex; gap:8px; align-items:center; }
	#vis { width:100%; max-width:1200px; margin-top:8px; }
	button { padding:6px 10px; border-radius:6px; border:1px solid #cfd8dc; background:#fff; cursor:pointer; }
	label { font-weight:600; margin-right:6px; color:#345a6a; }
	.lead { font-size:18px; font-weight:700; color:#0b3b50; margin-right:18px; }
	.page-title {
		/* responsive, prominent title */
		font-size: clamp(32px, 5.2vw, 56px);
		font-weight: 900;
		margin: 0 0 14px 0;
		color: #0b3b50;
		letter-spacing: -0.6px;
		line-height: 1.02;
		display: flex;
		align-items: center;
	}
	/* NATO-style emblem (simple, original compass/star) */
	.nato-badge { display:inline-block; vertical-align:middle; margin-right:10px; }
	/* larger emblem to match title scale */
	.nato-badge svg { width:58px; height:58px; display:block; }
	.nato-badge.small svg { width:18px; height:18px; }
	/* ensure good contrast when used on colored backgrounds */
	.nato-badge svg .fill { fill:#0b6fb4; }
	.nato-badge svg .stroke { stroke:#083a57; stroke-width:1; stroke-linejoin:round; }
	.card {
		width: 100%;
		max-width: 1400px;
		margin: 18px auto;
		background: linear-gradient(180deg,#ffffff,#fbfdff);
		border-radius: 12px;
		box-shadow: 0 12px 36px rgba(12,40,60,0.06);
		padding: 14px;
		border: 1px solid rgba(8,20,30,0.04);
	}
	/* two-column content inside the centered card */
	.content-row { display:flex; gap:18px; align-items:flex-start; justify-content:center; flex-wrap:wrap; }
	/* keep the map column wide on large screens so projection stays readable */
	.map-column { flex: 0 0 1000px; overflow: hidden; }
	/* ensure embedded Vega SVG scales to container width (prevents overlap) */
	#vis svg { max-width: 100%; height: auto; display: block; }
	/* overview sits to the right on wide screens */
	.story { width: 360px; /* adjusted to sit beside 1000px map */ }

	/* small screens: stack overview above the map to avoid overlap */
	@media (max-width: 1200px) {
		.map-column { flex-basis: 100%; }
		.story { width: 100%; order: -1; margin-bottom: 12px; }
	}
	/* tabs for switching main views */
	.view-tabs { display:flex; gap:8px; margin:10px 0 14px; }
	.view-tab { padding:8px 12px; border-radius:8px; background:#fff; border:1px solid #e3edf4; cursor:pointer; font-weight:700; color:#0b3b50; }
	.view-tab.active { background:#0b6fb4; color:#fff; box-shadow:0 8px 20px rgba(11,111,180,0.12); }
	/* placeholder panels */
	.panel { margin-top:8px; padding:8px; border:1px dashed #e6eef3; border-radius:8px; background:#fbfdff; display:none; }
	.panel.visible { display:block; }
	/* small stat cards inside the overview */
	.stat-row { display:flex; gap:10px; margin:8px 0 12px; flex-wrap:wrap; }
	.stat-card {
		background:linear-gradient(180deg,#ffffff,#f5fbff);
		border:1px solid #e2eef6;
		padding:8px 10px;
		border-radius:8px;
		min-width:120px;
		text-align:left;
		font-weight:700;
		color:#0b3b50;
		box-shadow:0 6px 18px rgba(8,20,30,0.04);
	}
	.stat-card .label { display:block; font-size:12px; color:#4f6b7b; font-weight:600; margin-bottom:6px; }
	.stat-card .value { font-size:18px; color:#083a57; }
	.founding-list { margin:8px 0 6px 14px; color:#13334d; font-weight:600; }
	details.article5 { margin-top:10px; border-top:1px dashed #e6eef3; padding-top:10px; }
	details.article5 summary { font-weight:800; cursor:pointer; }
	.source { font-size:12px; color:#577b8b; margin-top:8px; display:block; }

	/* History timeline styles */
	.history-summary { font-weight:700; color:#0b3b50; margin:2px 0 6px 0; }
	.timeline { margin-top:4px; padding-left:6px; position:relative; }
	.timeline::before { content:""; position:absolute; left:16px; top:2px; bottom:2px; width:2px; background:#e6eef3; border-radius:2px; }
	.timeline-item { display:flex; gap:8px; align-items:flex-start; margin:4px 0; }
	.timeline-dot { width:10px; height:10px; border-radius:50%; background:#fff; border:2px solid #bcdbe6; flex:0 0 10px; box-shadow:0 1px 3px rgba(0,0,0,0.04); margin-top:6px; }
 	.timeline-item button { background:transparent; border:0; padding:0; text-align:left; cursor:pointer; color:#13334d; font-weight:600; }
 	.timeline-item .year { font-size:13px; color:#4f6b7b; display:block; margin-bottom:4px; }
 	.timeline-item .desc { font-size:14px; color:#0b3b50; line-height:1.25; }
 	.timeline-item.active .timeline-dot { border-color:#0b6fb4; background:#0b6fb4; }
 	.article5-box { margin-top:12px; padding:10px; border-radius:8px; background:linear-gradient(180deg,#fff8e1,#fff); border:1px solid #ffecb3; color:#7a4b00; font-weight:700; }
 	/* larger historic map occupying the panel width */
	.hist-map { width:100%; max-width:380px; height:240px; border-radius:6px; overflow:hidden; border:1px solid #e6eef3; margin:4px 0 6px 0; background:#fff; }

#corePanel {
    padding: 24px;
}

/* Layout for the history content and map */
.history-layout {
    display: flex;
    gap: 0; /* This removes the space between the text and map */
    align-items: flex-start;
    justify-content: center;
    flex-wrap: wrap; 
}

/* Text content column */
#corePanel .history-content {
    flex: 1 1 400px;  
    max-width: 450px;
    padding-right: 15px; /* Adds a little internal padding so text doesn't touch the map */
}

/* Map figure column */
#corePanel .hist-figure {
    flex: 2 1 900px;  
    max-width: 1100px; 
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
#corePanel .hist-img {
    width: 100%;
    height: 500px;
    border-radius: 8px;
    border: 1px solid #e6eef3;
    display: block;
    box-shadow: 0 8px 24px rgba(12, 40, 60, 0.08);
}

/* Text styling - kept from previous version */
#corePanel h3 { margin: 0 0 16px 0; font-size: 26px; color: #083a57; }
#corePanel p { margin: 10px 0; font-size: 17px; line-height: 1.5; }
#corePanel ul { margin: 10px 0; padding-left: 22px; font-size: 17px; }
#corePanel ul li { margin-bottom: 5px; }
#corePanel .hist-caption { font-size: 14px; color: #577b8b; text-align: center; font-weight: 600; }

    
</style>
</head>
<body>
	<h1 class="page-title"><span class="nato-badge" role="img" aria-label="NATO emblem">
			<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
				<circle cx="32" cy="32" r="30" class="stroke" fill="#fff"/>
				<g transform="translate(32,32)">
					<path class="fill" d="M0,-20 L4,-4 L20,0 L4,4 L0,20 L-4,4 L-20,0 L-4,-4 Z"></path>
					<circle r="3" class="stroke" fill="#fff"/>
				</g>
			</svg>
		</span>NATO: 75 Years of Collective Defense</h1>
	<div class="header">
		<div class="lead">NATO timelapse</div>
		<div class="controls" aria-hidden="false">
			<button id="playPause">Play</button>
			<span id="yearLabel" style="font-weight:700">Year: 1949</span>
		</div>
	</div>
	<!-- view tabs: Core / Growth / Commitment / Context / Actions -->
	<div class="view-tabs" role="tablist" aria-label="Main views">
		<button class="view-tab active" data-view="growth" role="tab">Growth</button>
		<button class="view-tab" data-view="core" role="tab">History</button>
		<button class="view-tab" data-view="commitment" role="tab">Commitment</button>
		<button class="view-tab" data-view="context" role="tab">Context</button>
		<button class="view-tab" data-view="actions" role="tab">Actions</button>
	</div>

	<!-- centered card with the map on the left and overview on the right -->
	<div class="card" role="region" aria-label="Map and overview">
		<div class="content-row">
			<div class="map-column">
				<div id="vis" style="width:100%; height:auto;"></div>
			</div>

			<!-- improved overview: stats, founding members, Article 5 -->
			<div class="story" id="storyPanel" aria-live="polite">
				<h2>NATO overview</h2>

				<div class="stat-row" aria-hidden="false">
					<div class="stat-card" role="note" aria-label="Members count">
						<span class="label">Members</span>
						<span class="value">32</span>
						<span class="source">since 2024</span>
					</div>
					<div class="stat-card" role="note" aria-label="Founded">
						<span class="label">Founded</span>
						<span class="value">1949</span>
						<span class="source">Washington Treaty</span>
					</div>
					<div class="stat-card" role="note" aria-label="2% guideline">
						<span class="label">2% guideline</span>
						<span class="value">Defence target</span>
						<span class="source">NATO guideline</span>
					</div>
					<div class="stat-card" role="note" aria-label="Members meeting 2 percent">
						<span class="label">Meets 2%</span>
						<span class="value">(see chart)</span>
						<span class="source">data panel</span>
					</div>
				</div>

				<div class="purpose" aria-hidden="false">
					Collective defence pact<br>
					Mutual self-defence<br>
					Political and military<br>
					cooperation across allies
				</div>

				<!-- founding members (short bullets) -->
				<div style="margin-top:10px;">
					<strong>Founding members</strong>
					<p style="margin:6px 0 8px 0;color:#345a6a;">Highlighted on the map.</p>
					<button id="toggleFounders" class="map-button" aria-pressed="false" title="Toggle highlighting of founding members">Highlight founders</button>
				</div>

				<!-- Article 5: collapsible full text with link to source -->
				<details class="article5" aria-labelledby="article5">
					<summary id="article5" role="button">Article 5 - collective defence</summary>
					<p>
						The Parties agree that an<br>
						armed attack against one<br>
						or more of them in<br>
						Europe or North America<br>
						shall be considered an<br>
						attack against them all.
					</p>
					<p class="source">Full text: <a href="https://www.nato.int/cps/en/natohq/official_texts_17120.htm" target="_blank" rel="noopener">NATO treaty</a></p>
				</details>

				<!-- short note on relevance -->
				<div style="margin-top:10px;font-weight:600;color:#345a6a;">
					Why this matters<br>
					Collective security underpins<br>
					alliance deterrence and action.
				</div>
				<!-- joined members overview (updates with year_slider) -->
				<div id="joinsOverview" style="margin-top:12px;">
					<strong>Joined so far</strong>
					<div id="joinsCount" style="font-weight:700;margin:6px 0 6px 0;color:#0b3b50;">0 countries</div>
					<div id="joinsList" style="max-height:120px; overflow:auto; padding:6px; border:1px solid #e6eef3; border-radius:6px; background:#fff;"></div>
				</div>

				<div class="milestone" id="milestoneText" style="margin-top:12px;">
					1949 - Founding members<br>
					(see map for dates)
				</div>

				<small>Tip: press Play to animate</small>
			</div>
		</div>
	</div>
    
	<div id="corePanel" class="panel" aria-hidden="true">
    <div class="history-layout">
        <div class="history-content">
            <h3>History: Why NATO Formed</h3>

            <p>After World War II, Europe lay in ruins.</p>
            <p>Wartime alliance dissolved, suspicion took hold.</p>
            <p>Soviet forces occupied Eastern European nations.</p>
            <p>Democratic governments were replaced or pressured.</p>
            <p>Western leaders feared further Soviet expansion.</p>

            <p><strong>Key Catalysts:</strong></p>
            <ul>
                <li>1947 - Truman Doctrine: US aid.</li>
                <li>1948 - Czechoslovakia Coup: Communist takeover.</li>
                <li>1948-49 - Berlin Blockade: Allied airlift response.</li>
            </ul>

            <p>Individual defense was weak, politically and militarily.</p>
            <p>Allies sought collective security, mutual deterrence.</p>
            <p>April 4, 1949: Washington Treaty signed.</p>
            <p>Article 5 created a mutual defense pledge.</p>

            <p><strong>Why It Matters:</strong></p>
            <ul>
                <li>Deters major aggression</li>
                <li>Coordinates allied defense</li>
                <li>Anchors political solidarity</li>
            </ul>
        </div>

        <div class="hist-figure" role="img" aria-label="Map of Europe in 1946">
            <img src="europe-1946.png" alt="Map showing post-war political divisions in Europe around 1946" class="hist-img">
            <p class="hist-caption">Post-war divisions in Europe, c. 1946</p>
        </div>
    </div>
</div>
	<div id="growthPanel" class="panel visible" aria-hidden="false">
		<h3>Growth of the Alliance</h3>
		<p>Expansion timeline map: animated map view (currently the map above).</p>
	</div>
	<div id="commitmentPanel" class="panel" aria-hidden="true">
		<h3>Member Commitment & Strength</h3>
		<p>Defense spending (% GDP): bar chart placeholder.</p>
		<p>Total military personnel: table placeholder.</p>
	</div>
	<div id="contextPanel" class="panel" aria-hidden="true">
		<h3>NATO in Global Context</h3>
		<p>Power comparison charts: NATO vs Russia vs China.</p>
	</div>
	<div id="actionsPanel" class="panel" aria-hidden="true">
		<h3>NATO in Action</h3>
		<p>Map of key missions and deployments placeholder.</p>
	</div>

<script>
const spec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1400,
  "height": 750,
  "autosize": {"type":"fit","contains":"padding"},
  "background": null,
  "params": [
    {
      "name": "year_slider",
      "value": 1949,
      "bind": {
        "input":"range",
        "min": 1949,
        "max": 2024,
        "step": 1,
        "name": "Year: "
      }
    },
    { "name": "show_founders", "value": false }
  ],
  "layer": [
		{
			// ocean / sphere layer (beneath countries)
			"data": {"sphere": true},
			"mark": {"type":"geoshape", "fill": "#dff3fb", "stroke": null},
			"projection": {"type":"naturalEarth1","scale":230,"translate":[700,375]}
		},
 		{
 			"data": {
 				"url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json",
 				"format": {"type":"topojson","feature":"countries"}
 			},
 			"transform": [
 				{
 					"lookup": "properties.name",
 					"from": {
 						"data": {"url": "NATO.csv"},
 						"key": "Country",
 						"fields": ["Year joined"]
 					}
 				}
 			],
 			"mark": {"type":"geoshape", "stroke": "#777", "strokeWidth": 0.35},
			"projection": {"type":"naturalEarth1","scale":230,"translate":[700,375]},
 			"encoding": {
 				"color": {
 					"condition": [
 						{
 							"test": "datum['Year joined'] != null && datum['Year joined'] <= year_slider",
 							"value": "#1f77b4"
 						}
 					],
 					"value": "#e9edf1"
 				},
 				"tooltip": [
 					{"field":"properties.name","type":"nominal","title":"Country"},
 					{"field":"Year joined","type":"quantitative","title":"Year joined (NATO)"}
 				]
 			}
 		},
		{
			// founders highlight layer (visible only when show_founders is true)
			"data": {
				"url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json",
				"format": {"type":"topojson","feature":"countries"}
			},
			"transform": [
				{
					"lookup": "properties.name",
					"from": {
						"data": {"url": "NATO.csv"},
						"key": "Country",
						"fields": ["Year joined"]
					}
				}
			],
			"mark": {"type":"geoshape", "fill": "transparent", "stroke": "#000000", "strokeWidth": 3},
			"projection": {"type":"naturalEarth1","scale":230,"translate":[700,375]},
			"encoding": {
				"opacity": {
					"condition": [
						{ "test": "show_founders && datum['Year joined'] == 1949", "value": 1 }
					],
					"value": 0
				}
			}
		},
		{
			// graticule (latitude/longitude grid)
			"data": {"graticule": {"step": [30, 30]}},
			"mark": {"type":"geoshape", "fill": null, "stroke": "#bcdbe6", "strokeWidth": 0.6, "opacity": 0.7},
			"projection": {"type":"naturalEarth1","scale":230,"translate":[700,375]}
		},
 		{
 			// outline for all countries to keep consistent borders on colored fill
 			"data": {"url":"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json","format":{"type":"topojson","feature":"countries"}},
			"mark": {"type":"geoshape","fill":null,"stroke":"#555","strokeWidth":0.25},
			"projection": {"type":"naturalEarth1","scale":230,"translate":[700,375]}
 		}
 	]
};

vegaEmbed('#vis', spec, {actions:false, renderer:'svg'}).then(result => {
  const view = result.view;
  // load NATO.csv once and provide update function for overview
  let natoData = [];
  async function loadNatoCsv() {
    try {
      const res = await fetch('NATO.csv');
      const txt = await res.text();
      const lines = txt.trim().split(/\r?\n/);
      const hdr = lines.shift().split(',').map(h => h.trim());
      const countryIdx = hdr.indexOf('Country');
      const yearIdx = hdr.indexOf('Year joined');
      natoData = lines.map(line => {
        // simple CSV row parse (handles commas in quotes minimally)
        const parts = line.split(',');
        const country = (parts[countryIdx] || '').trim();
        const yearRaw = (parts[yearIdx] || '').trim();
        const year = yearRaw === '' ? null : +yearRaw;
        return { Country: country, Year: year };
      }).filter(d => d.Country);
    } catch (e) { console.warn('Failed to load NATO.csv', e); natoData = []; }
  }

  function updateJoinsForYear(year) {
    if (!natoData || !natoData.length) {
      document.getElementById('joinsCount').textContent = 'No data';
      document.getElementById('joinsList').textContent = '';
      return;
    }
    const joined = natoData.filter(d => d.Year != null && d.Year <= year)
                           .sort((a,b) => (a.Year - b.Year) || a.Country.localeCompare(b.Country));
    const count = joined.length;
    document.getElementById('joinsCount').textContent = `${count} countries`;
    const listEl = document.getElementById('joinsList');
    // show grouped by year, most recent first
    const grouped = {};
    joined.forEach(d => {
      const y = d.Year || 'Unknown';
      if (!grouped[y]) grouped[y] = [];
      grouped[y].push(d.Country);
    });
    // build HTML: recent years on top
    const years = Object.keys(grouped).map(y => +y).filter(n => !isNaN(n)).sort((a,b) => b - a)
                  .concat(Object.keys(grouped).filter(y => isNaN(+y))); // unknown at end
    listEl.innerHTML = years.map(y => {
      const names = grouped[y].map(n => {
        // highlight if joined exactly this year (current year)
        const cls = (y === year) ? 'current-join' : '';
        return `<div style="padding:2px 0;"><span class="${cls}" style="${cls ? 'font-weight:800;color:#0b6fb4;' : ''}">${escapeHtml(n)}</span></div>`;
      }).join('');
      return `<div style="margin-bottom:6px;"><div style="font-size:12px;color:#4f6b7b;font-weight:700;margin-bottom:4px;">${y}</div>${names}</div>`;
    }).join('');
  }

  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // initialize CSV and initial joins display
  (async function(){ await loadNatoCsv(); try { const init = await view.signal('year_slider') || 1949; updateJoinsForYear(init); } catch(e){} })();

  // wire founders toggle button to the Vega param 'show_founders'
  (function setupFoundersToggle() {
    const btn = document.getElementById('toggleFounders');
    if (!btn || !view) return;
    let state = false;
    async function setState(next) {
      try {
        state = !!next;
        btn.setAttribute('aria-pressed', state ? 'true' : 'false');
        btn.classList.toggle('active', state);
        await view.signal('show_founders', state);
        await view.runAsync();
      } catch (e) { console.warn('Failed to set show_founders', e); }
    }
    btn.addEventListener('click', () => setState(!state));
    // initialize from signal if available
    try { view.signal('show_founders').then(v => setState(!!v)); } catch(e){}
  })();
  // story events used by the sidebar
  const MILESTONES = [
    { y:1949, lines: ['1949 - NATO founded','Original 12 members'] },
    { y:1952, lines: ['1952 - Greece and Turkey','join NATO'] },
    { y:1982, lines: ['1982 - Spain joins NATO'] },
    { y:1999, lines: ['1999 - Central Europe','(Poland, Hungary, Czech)'] },
    { y:2004, lines: ['2004 - Major eastern','enlargement of members'] },
    { y:2009, lines: ['2009 - Albania and Croatia','join NATO'] },
    { y:2017, lines: ['2017 - Montenegro joins NATO'] },
    { y:2020, lines: ['2020 - North Macedonia','becomes an Ally'] },
    { y:2023, lines: ['2023 - Finland joins NATO'] },
    { y:2024, lines: ['2024 - Sweden joins NATO'] }
  ];
  const storyEl = document.getElementById('storyPanel');
  const milestoneEl = document.getElementById('milestoneText');
  const article5El = document.getElementById('article5');

  function renderMilestoneForYear(year) {  // keep UI year label in sync with the signal
    // find latest milestone <= yearntent = 'Year: ' + y; }
    const filtered = MILESTONES.filter(m => m.y <= year);
    if (!filtered.length) {  // initial label
	  milestoneEl.innerHTML = 'No milestone yet<br>Use slider or Play';
	  return;
	}
    const latest = filtered[filtered.length - 1];(init);
    // compose safe lines (each <=7 words)
    milestoneEl.innerHTML = latest.lines.map(l => escapeHtml(l)).join('<br>');
  }  // listen for user-driven slider changes inside the embed
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
// Animation and year label logic
  const playBtn = document.getElementById('playPause');
  const yearLabel = document.getElementById('yearLabel');
  let playing = false;
  let timer = null;

  function updateYearLabel(y) {
	yearLabel.textContent = 'Year: ' + y;
  }

  // initial label
  try {
	const init = view.signal('year_slider') || 1949;
	updateYearLabel(init);
	renderMilestoneForYear(init);
  } catch(e){}

  // listen for user-driven slider changes inside the embed
  if (view.addSignalListener) {
      view.addSignalListener('year_slider', (name, value) => {
        updateYearLabel(value);
        renderMilestoneForYear(value);
        updateJoinsForYear(value);
      });
    }

  function start() {
	if (playing) return;
	playing = true;
	playBtn.textContent = 'Pause';
	timer = setInterval(async () => {
	  try {
		const current = await view.signal('year_slider');
		let next = (current == null ? 1949 : +current) + 1;
		if (next > 2024) next = 1949;
		await view.signal('year_slider', next);
		await view.runAsync();
	  } catch(e) { /* ignore */ }
	}, 650);
  }

  function stop() {
	playing = false;
	playBtn.textContent = 'Play';
	if (timer) { clearInterval(timer); timer = null; }
  }

  playBtn.addEventListener('click', () => {
	if (playing) stop(); else start();
  });

  // simple tab switching logic for the panels
  (function setupTabs(){
    const tabs = Array.from(document.querySelectorAll('.view-tab'));
    const panels = {
      core: document.getElementById('corePanel'),
      growth: document.getElementById('growthPanel'),
      commitment: document.getElementById('commitmentPanel'),
      context: document.getElementById('contextPanel'),
      actions: document.getElementById('actionsPanel')
    };
    function show(view){
      tabs.forEach(t => t.classList.toggle('active', t.dataset.view === view));
      Object.keys(panels).forEach(k => {
        const el = panels[k];
        if (!el) return;
        el.classList.toggle('visible', k === view);
        el.setAttribute('aria-hidden', k === view ? 'false' : 'true');
      });
      // keep Growth map visible above; other panels are explanatory/placeholders
    }
    tabs.forEach(t => t.addEventListener('click', () => show(t.dataset.view)));
    // default
    show('growth');
  })();

  // toggle founders highlighting
  (function setupFoundersToggle(){
    const toggleBtn = document.getElementById('toggleFounders');
    let showFounders = false;

    toggleBtn.addEventListener('click', () => {
      showFounders = !showFounders;
      view.signal('show_founders', showFounders).run();
      toggleBtn.textContent = showFounders ? 'Hide founding members' : 'Show founding members';
    });

    // initial state
    toggleBtn.textContent = showFounders ? 'Hide founding members' : 'Show founding members';
  })();

  // Timeline button interactions - jump map to selected year
  (function setupTimelineButtons(){
    const buttons = Array.from(document.querySelectorAll('.timeline-btn'));
    if (!buttons.length || !view) return;
    buttons.forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const y = +btn.getAttribute('data-year') || 1949;
        // update slider signal and run view
        try {
          await view.signal('year_slider', y);
          await view.runAsync();
        } catch (err) { console.warn('Failed to set year signal', err); }
        // visual active state
        document.querySelectorAll('.timeline-item').forEach(it => it.classList.remove('active'));
        const item = btn.closest('.timeline-item');
        if (item) item.classList.add('active');
      });
    });
  })();

  // Joined countries logic - update overview box
  (function setupJoinsOverview(){
    const joinsCountEl = document.getElementById('joinsCount');
    const joinsListEl = document.getElementById('joinsList');
    let NATOdata = [];

    // Load and parse NATO.csv data
    fetch('NATO.csv')
      .then(response => response.text())
      .then(text => {
        // Parse CSV text into array of objects
        NATOdata = text.split('\n').slice(1).map(line => {
          const [Country, YearJoined] = line.split(',');
          return { Country, YearJoined: +YearJoined };
        }).filter(d => !isNaN(d.YearJoined));
        // Initial update for year 1949
        updateJoinsForYear(1949);
      });

    function updateJoinsForYear(year) {
      // Filter countries that joined up to the current year
      const joinedCountries = NATOdata.filter(d => d.YearJoined <= year);
      const count = joinedCountries.length;

      // Update count display
      joinsCountEl.textContent = `${count} country${count !== 1 ? 'ies' : ''}`;

      // Update list display with smooth transition
      joinsListEl.style.opacity = 0; // Fade out
      setTimeout(() => {
        // Update the HTML for the list
        joinsListEl.innerHTML = joinedCountries.map(d => `<div style="padding:2px 0; color:${d.YearJoined === year ? '#0b6fb4' : '#13334d'}">${d.Country} ${d.YearJoined === year ? '‚Üê' : ''}</div>`).join('');
        joinsListEl.style.opacity = 1; // Fade in
      }, 300);
    }

    // Update joins overview when the year_slider signal changes
    if (view.addSignalListener) {
      view.addSignalListener('year_slider', (name, value) => {
        updateJoinsForYear(value);
      });
    }
  })();

}).catch(err => console.error(err));
</script>
</body>
</html>
